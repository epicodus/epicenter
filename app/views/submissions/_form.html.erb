<%= form_for [@code_review, @submission] do |f| %>
  <%= render 'layouts/errors', object: @submission %>
  <%= f.hidden_field :needs_review, value: true %>
  <%= f.hidden_field :student_id, value: current_student.id if current_student %>

  <% if @code_review.survey && !SurveyResponse.find_by(survey_question: @code_review.survey.questions.first, student: @submission.student)  %>
    <%= render @code_review.survey %>
  <% end %>

  <div class="form-group">
    <%= f.label :link, 'Submission link' %>
    <%= f.text_field :link, class: 'form-control', placeholder: 'http://github.com/your-username/your-repository' %>
  </div>

  <div class="panel panel-default">
    <div class="panel-body">
      <%= f.label :notes, "Please summarize your experience with this project in a few short sentences. Feel free to highlight challenges you faced, or questions you have. This is required, but will not be graded or contribute to your grade." %>
      <%= f.nested_fields_for :notes, @submission.notes.build do |ff| %>
        <%= ff.text_area :content, rows: 5, maxlength: 2000, class: 'form-control', id: 'submission-student-note', required: true %>
      <% end %>
      <% if @submission.notes.where('id IS NOT NULL').any? %>
        <div class="well">
          <p class="text-center"><strong>notes previously submitted</strong></p>
          <ul>
            <% @submission.notes.where('id IS NOT NULL').each do |note| %>
              <li><strong><%= note.created_at.strftime('%B %d') %>:</strong> <%= note.content %></li>
            <% end %>
          </ul>
        </div>
      <% end %>
    </div>
  </div>

  <div class="form-group">
    <p>
      I confirm that I have read and understand the <a href="https://www.learnhowtoprogram.com/lessons/independent-projects-and-code-reviews" target=_blank>guidelines</a> for Independent Projects.
      &nbsp;&nbsp;<%= check_box_tag nil, 1, checked = false, { required: true, id: 'understand-guidelines' } %>
    </p>
    <p>&nbsp;</p>
  </div>

  <%= f.submit @submission.new_record? ? 'Submit' : 'Resubmit', class: 'btn btn-info' %>
<% end %>
